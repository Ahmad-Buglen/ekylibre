#!/usr/bin/env bash

script_path=`readlink -f $0`
script_dir=`dirname $script_path`
test_database=ekylibre_test

cp -f $script_dir/database.$DB.yml $script_dir/../../config/database.yml

if [ "$DB" -eq "postgis" ]; then
    psql -c "CREATE DATABASE $test_database;" -U postgres
    psql -U postgres -d $test_database -c "CREATE SCHEMA postgis;"

    if [ "$POSTGIS" -eq "2.0" ]; then
	psql -U postgres -d $test_database -c "CREATE EXTENSION postgis;"
    else
	createlang -U postgres plpgsql $test_database
	psql -U postgres -d $test_database -f /usr/share/postgresql/9.1/contrib/postgis-1.5/postgis.sql
	psql -U postgres -d $test_database -f /usr/share/postgresql/9.1/contrib/postgis-1.5/spatial_ref_sys.sql
    fi
elif [ "$DB" -eq "mysql" ]; then
    mysql -e "CREATE DATABASE $test_database;"
fi
