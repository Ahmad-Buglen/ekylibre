<?xml version="1.0" encoding="UTF-8"?>
<aggregators xmlns="http://www.ekylibre.org/XML/2013/aggregators">
  <aggregator name="veterinary_booklet">
    <parameters>
      <parameter name="campaigns" type="record-list" of="campaign" default="currents"/>
      <parameter name="company" type="record" of="entity" default="of_company"/>
      <parameter name="breeding_number" type="string" default="XXXXXXXX"/>
    </parameters>
    <section name="company">
      <attribute name="full_name"/>
      <attribute name="address" value="company.default_mail_address.coordinate"/>
      <attribute name="breeding_number"/>
      <collection name="interventions" with="Procedure.of_nature(:animal_care)">
	<attribute name="id" level="api"/>
	<title name="name"/>
	<variable name="target" value="intervention.variables.of_role(:target).first.target"/>
	<variable name="worker" value="intervention.variables.of_role(:worker).first.target"/>
	<table name="inputs" with="intervention.variables.of_role(:input)">
	  <column name="id" level="api"/>
	  <within name="target">
	    <column name="identification_number"/>
	    <column name="name"/>
	    <column name="id" level="api"/>
	    <column name="type" level="api"/>
	  </within>
	  <within name="worker">
	    <column name="identification_number"/>
	    <column name="name"/>
	    <column name="id" level="api"/>
	    <column name="person_id" level="api"/>
	  </within>
	  <within value="input.target">
	    <column name="name"/>
	    <column name="nature_name"/>
	    <column name="variety" level="api"/>
	  </within>
	  <within value="input.target">
	    <column name="name"/>
	    <column name="nature_name"/>
	    <column name="variety" level="api"/>
	  </within>
	  <column name="measure_quantity"/>
	  <column name="measure_unit"/>
	  <within name="incident" value="intervention.incident">
	    <column name="id" level="api"/>
	    <column name="name"/>
	    <column name="observed_at"/>
	    <column name="state" level="api"/>
	    <column name="description"/>
	  </within>	
	  <within name="prescription" value="intervention.prescription">
	    <column name="id" level="api"/>
	    <column name="reference_number" if="true"/>
	    <column name="prescriptor_name"/>
	  </within>	
	</table>
      </collection>
    </section>
  </aggregator>
</aggregators>