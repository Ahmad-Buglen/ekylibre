<?xml version="1.0"?>
<template title="Sales order" lang="en" version="2.0">
  <infos>
    <info name="authors">Thibaud Mérigon, Brice Texier</info>
  </infos>
  <parameters>
    <parameter name="sales_order" nature="sales_order">Sales order</parameter>
  </parameters>
  <document unit="mm" size="10" title="{{sales_order.number}}">
    <page orientation="portrait" format="A4" margin="10mm">
      <part height="72mm">
        <set>
          <image value="{{Entity.of_company/picture.url(:original)}}" height="30mm">
            <text value="{{Entity.of_company/full_name}}" size="16"/>
          </image>
          <text value="{{sales_order/mail_address}}" align="left" font="helvetica" top="42mm" left="100mm"/>
        </set>
      </part>
      <part height="11mm">
        <set>
          <text value="À {{Entity.of_company.default_mail_address.mail_area/city_name?capitalize=true}}, le {{sales_order/created_on?format=month_letter}}" left="100%" align="right"/>
          <text value="Devis N°{{sales_order/number}}" bold="true"/>
        </set>
        <set if="sales_order.responsible" top="4mm">
          <text value="Entre {{Entity.of_company/full_name}}, {{sales_order.responsible/full_name}} et {{sales_order.client/full_name}}."/>
        </set>
      </part> 

      <part if="sales_order/letter?" height="4mm">
        <set>
          <text value="{{sales_order.function_title}}" bold="true" left="10mm"/>
        </set>
      </part>
      <part if="sales_order/letter?">
        <set>
          <text value="{{sales_order.introduction}}" width="100%" resize="true"/>
        </set>
      </part>
      
      <table collection="sales_order.lines" fixed="true">
        <column label="Code" property="product/number" width="20mm" align="center"/>
        <column label="Désignation" property="designation" width="80mm"/>
        <column label="Qté." property="quantity" width="13mm" numeric="money"/>
        <column label="Prix unitaire Hors Taxes" property="price/pretax_amount" width="22mm" numeric="money"/>
        <column label="Montant Hors Taxes" property="pretax_amount" width="20mm" numeric="money"/>
        <column label="Montant T.V.A." property="taxes_amount" width="20mm" numeric="money"/>
        <column label="Taux T.V.A." property="price.tax/amount" width="15mm" align="center"/>
      </table>
      
      
      <part height="14mm">
        <set right="90mm" top="1mm">
          <text value="Totaux ({{sales_order.currency}})" top="0.5mm" left="34mm" align="right" bold="true"/>
          <text value="Net à payer ({{sales_order.currency}})" top="6mm" left="34mm" align="right" bold="true" size="11.5"/>
          <text value="{{sales_order.amount?numeric}}" top="6mm" left="55mm" align="center" bold="true" size="12"/>
          <text value="{{sales_order.pretax_amount?numeric}}" top="0.5mm" left="54.5mm" align="right"/>
          <text value="{{sales_order.taxes_amount?numeric}}" top="0.5mm" left="74.5mm" align="right"/>
          <rectangle width="75mm" height="4mm" border="0.5 solid #000"/>
          <rectangle width="75mm" height="7mm" border="0.5 solid #000" top="4mm"/>
          <line path="35mm,0 ; 35mm,11mm" border="0.5 solid #000"/>
          <line path="55mm,0 ; 55mm,4mm"  border="0.5 solid #000"/>
        </set>
      </part>



      <part height="7mm" if="sales_order/letter?">
        <set>
          <text value="{{sales_order/conclusion}}" width="100%" resize="true"/>
        </set>
      </part>
  
      <part height="8mm" if="sales_order/letter? and sales_order/nature/payment_mode">
        <set top="2mm">
          <text value="Mode de paiement : " bold="true"/>
          <text value="{{sales_order/nature/payment_mode/name}} {{sales_order/nature/payment_mode_complement}}" left="31mm"/>
        </set>
      </part>
      

      <part height="5mm">
        <set>
          <text value="Conditions générales :" bold="true"/>
        </set>
        <set top="5mm">
          <list columns="2" collection="sales_order.sales_conditions" resize="true" font="Times" size="7"/>
        </set>
      </part>

      <part height="25mm" if="sales_order/letter?">
        <set>
          <text value="Dans la case ci-contre, veuillez dater, porter la mention &quot;Bon pour accord&quot; et apposer votre signature." bold="true" top="3mm" right="93mm" width="60mm" align="right"/>
          <rectangle width="75mm" height="20mm" right="90mm" top="3mm" border="0.5 solid #000"/>
        </set>
      </part>
      
      <part height="30mm" if="sales_order/letter?"> 
        <set>
          <text value="Dans l'attente de votre réponse,"/>
          <text value="Veuillez agréer, {{sales_order.function_title}}, l'expression de mes salutations distinguées." top="4mm"/>
        </set>
        <set if="sales_order.responsible" left="145mm" top="12mm"> 
          <text value="{{sales_order.responsible/label}}" bold="true" align="center"/>
          <text value="Service {{sales_order.responsible.department/name}}" align="center" top="4mm"/>
        </set>
      </part>

      <!-- Deliveries -->
      
      <part height="15mm" bottom="true">
        <set>
          <line path="0,1mm ; 100%,1mm" border="0.5 solid #000"/>
          <set top="2.5mm"> 
            <text value="Devis n°{{sales_order/number}}" size="10" align="left"/>
            <text value="Réf. Client : {{sales_order.client/code}}" top="4mm" align="left"/>
            <text value="Page 1 sur 1" top="8mm" align="left"/>
            <text value="{{sales_order/created_on?format=month_letter}}" size="10" left="50%" align="center"/>
            <text value="N° TVA Intracommunautaire : {{Entity.of_company/vat_number}} - SIREN : {{Entity.of_company/siren}} - Code APE : {{Entity.of_company/activity_code}}" size="7" left="50%" align="center" top="6mm"/>
            <text value="Paraphe" size="10" right="20mm" align="right" bold="true"/>
            <rectangle width="18mm" height="8mm" right="18mm" border="0.5 solid #000"/>
          </set>
        </set>
      </part>
      
    </page>
    
  </document>
</template>
