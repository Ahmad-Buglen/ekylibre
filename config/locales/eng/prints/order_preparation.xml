<?xml version="1.0"?>
<template title="Example" lang="fr" version="2.0">
  <infos>
    <info name="authors">Thibaud Mérigon, Brice Texier</info>
  </infos>
  <parameters>
    <parameter name="transport" nature="transport">Transport</parameter>
  </parameters>
  <document unit="mm" size="10" title="Preparation order">
    <page orientation="portrait" format="A4" margin="10mm">
           
      <part height="30mm">
	<set>
	  <text value="Destinataire :" />
	  <text value="{{transport.deliveries.first/address}}"  top="5mm" size="9"/>
	  <text value="Expéditeur :" left="65mm" align="left" />
	  <text value="{{Entity.of_company.default_mail_address/mail_coordinate}}" left="65mm" top="5mm"  size="9" align="left"/>
	  <text value="Transporteur :" left="130mm"/>
	  <text value="{{transport.transporter.default_mail_address/mail_coordinate}}"  top="5mm" left="130mm"  size="9"/>
	</set>
      </part>
      
      <part height="20mm">
	<set>
	  <text value="Poids (kg) : {{transport.deliveries.first.weight}}"/>
	  <text value="Date d'expédition : {{transport/transport_on?format=month_letter}}" top="5mm"/>
	  <text value="Nombre de colis : {{transport.deliveries.first/parcel_sum}}" top="10mm"/>
	</set>
      </part>

      <table collection="transport.deliveries.first.lines" fixed="true">
	<column label="Quantité" property="quantity" width="20mm"/>
	<column label="Produit" property="product.name" width="60mm"/>
	<column label="Montant" property="price.amount_with_taxes" width="40mm"/>
	<column label="Lieu de stockage" property="order_line.building/name" width="50mm"/>
      </table>


      <iteration variable="delivery" collection="transport.deliveries">
	<table collection="delivery.lines">
	  <column label="Produit" property="product.name" width="60mm"/>
	  <column label="Quantité" property="quantity" width="20mm"/>
	  <column label="Prix HT" property="price/amount" width="20mm"/>
	  <column label="Montant HT" property="amount" width="20mm"/>
	  <column label="Montant TTC" property="amount_with_taxes" width="20mm"/>
	</table>
      </iteration>

    </page>
  </document>
</template>
