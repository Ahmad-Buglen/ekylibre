<?xml version="1.0"?>
<template title="Example" lang="fr" version="2.0">
  <infos>
    <info name="authors">Thibaud Mérigon, Brice Texier</info>
  </infos>
  <parameters>
    <parameter name="entity" nature="entity">Fiche relation</parameter>
  </parameters>
  <document unit="mm" size="10" title="entity.label">
    <page orientation="portrait" format="A4" margin="10mm">

      <part height="20mm">
	<set>
	  <text value="{{entity/full_name}}"  left="50%" align="center" bold="true" size="14"/>
	</set>
      </part>
      
      <!-- Contacts -->
      <part if="entity.addresses.size > 0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.addresses.size.to_s}} contact(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <table if="entity.addresses.size&gt;0" collection="entity.addresses">
	<column label="Adresse" property="canal" width="95mm"/>
	<column label="Adresse" property="coordinate" width="95mm"/>
      </table>

      <!-- Ventes -->
      <part if="entity.sales.size&gt;0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.sales.size.to_s}} vente(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <iteration variable="sale" collection="entity.sales">
	<table collection="sale.lines">
	  <column label="Vente {{sale.number}} créée le {{sale.created_on}} d'un montant de {{sale.amount}}" property="product.name" width="100mm"/>
	  <column label="Qté." property="quantity" width="20mm" numeric="money"/>
	  <column label="Prix" property="price/pretax_amount" width="20mm" numeric="money"/>
	  <column label="HT" property="pretax_amount" width="20mm" numeric="money"/>
	  <column label="TTC" property="amount" width="20mm" numeric="money"/>
	</table>
      </iteration>
      
      <!-- Evénements -->
      <part if="entity.events.size > 0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.events.size.to_s}} événement(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <table if="entity.events.size&gt;0" collection="entity.events">
	<column label="Type" property="nature.name" width="25mm"/>
	<column label="Motif" property="reason" width="70mm"/>
	<column label="Employé" property="responsible.label" width="45mm"/>
	<column label="Durée" property="duration" width="15mm" numeric="money"/>
	<column label="Lieu" property="location" width="30mm"/>
	<column label="À débuté le" property="started_at.to_date" width="20mm"/>
      </table>
      
    </page>
  </document>
</template>
