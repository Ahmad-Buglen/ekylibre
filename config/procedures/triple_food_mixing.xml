<?xml version="1.0"?>
<procedures xmlns="http://www.ekylibre.org/XML/2013/procedures">
  <procedure name="triple_food_mixing" natures="food_mixing" version="0">
    <variables>
      <variable name="first_food_input" variety="mix" abilities="feed(animal)"/>
      <variable name="first_food_input_to_use" variety=":first_food_input" derivative-of=":first_food_input" new="parted-from: first_food_input" roles="food_mixing-input" default-name="{{variant}} ({{container}})">
        <handler indicator="population"/>
        <handler indicator="net_mass" unit="kilogram" if="first_food_input.net_mass(kilogram) &gt; 0" to="population" backward="value * self..net_mass(kilogram)" forward="value / self..net_mass(kilogram)"/>
        <handler name="net_mass_in_ton" indicator="net_mass" unit="ton" if="first_food_input.net_mass(ton) &gt; 0" to="population" backward="value * self..net_mass(ton)" forward="value / self..net_mass(ton)"/>
      </variable>
      <variable name="second_food_input" variety="mix" abilities="feed(animal)"/>
      <variable name="second_food_input_to_use" variety=":second_food_input" derivative-of=":second_food_input" new="parted-from: second_food_input" roles="food_mixing-input" default-name="{{variant}} ({{container}})">
        <handler indicator="population"/>
        <handler indicator="net_mass" unit="kilogram" if="second_food_input.net_mass(kilogram) &gt; 0" to="population" backward="value * self..net_mass(kilogram)" forward="value / self..net_mass(kilogram)"/>
        <handler name="net_mass_in_ton" indicator="net_mass" unit="ton" if="second_food_input.net_mass(ton) &gt; 0" to="population" backward="value * self..net_mass(ton)" forward="value / self..net_mass(ton)"/>
      </variable>
      <variable name="third_food_input" variety="mix" abilities="feed(animal)"/>
      <variable name="third_food_input_to_use" variety=":third_food_input" derivative-of=":third_food_input" new="parted-from: third_food_input" roles="food_mixing-input" default-name="{{variant}} ({{container}})">
        <handler indicator="population"/>
        <handler indicator="net_mass" unit="kilogram" if="third_food_input.net_mass(kilogram) &gt; 0" to="population" backward="value * self..net_mass(kilogram)" forward="value / self..net_mass(kilogram)"/>
        <handler name="net_mass_in_ton" indicator="net_mass" unit="ton" if="third_food_input.net_mass(ton) &gt; 0" to="population" backward="value * self..net_mass(ton)" forward="value / self..net_mass(ton)"/>
      </variable>
      <variable name="worker" variety="worker" roles="food_mixing-doer"/>
      <variable name="food_mix" variety="mix" new="produced-by: first_food_input" roles="food_mixing-output" default-name="{{variant}} [{{birth_day}}/{{birth_month}}/{{birth_year}}] ({{container}})">
        <handler indicator="population"/>
      </variable>
      <variable name="food_storage" abilities="store(mix)"/>
    </variables>
    <operations>
      <operation id="1">
        <task do="[first_food_input] parts with [first_food_input_to_use]"/>
        <task do="[second_food_input] parts with [second_food_input_to_use]"/>
        <task do="[third_food_input] parts with [third_food_input_to_use]"/>
        <task do="[first_food_input_to_use], [second_food_input_to_use] and [third_food_input_to_use] are mixed into [food_mix]"/>
        <task do="[food_mix] moves in [food_storage]"/>
      </operation>
    </operations>
  </procedure>
</procedures>
