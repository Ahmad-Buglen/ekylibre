<?xml version="1.0"?>
<procedures xmlns="http://www.ekylibre.org/XML/2013/procedures">
  <procedure name="wine_bottling" categories="viticulture_transformation" actions="wine_bottling">
    <variables>
      <variable name="tank" type="tool" variety="equipment" abilities="store(wine)" default-actor="storage"/>
      <variable name="wine" type="target" variety="wine" default-actor="first_localized_in: tank"/>
      <variable name="wine" type="input" variety="wine" default-name="{{variant}} ({{container}})">
        <handler indicator="population"/>
        <handler indicator="net_volume" unit="hectoliter" if="wine_to_pack? &amp; wine_to_pack.net_volume(liter) &gt; 0" to="population" backward="value * self..net_volume(hectoliter)" forward="value / self..net_volume(hectoliter)"/>
        <handler name="net_volume_in_liter" indicator="net_volume" unit="liter" if="wine_to_pack? &amp; wine_to_pack.net_volume(liter) &gt; 0" to="population" backward="value * self..net_volume(liter)" forward="value / self..net_volume(liter)"/>
      </variable>
      <variable name="bottles" type="input" variety="cork_bottle" default-name="{{variant}} ({{container}})" abilities="store(wine)">
        <handler indicator="population"/>
        <handler indicator="net_volume" unit="hectoliter" if="bottles_to_use? &amp; bottles_to_use.net_volume(liter) &gt; 0" to="population" backward="value * self..net_volume(hectoliter)" forward="value / self..net_volume(hectoliter)"/>
        <handler name="net_volume_in_liter" indicator="net_volume" unit="liter" if="bottles_to_use? &amp; bottles_to_use.net_volume(liter) &gt; 0" to="population" backward="value * self..net_volume(liter)" forward="value / self..net_volume(liter)"/>
      </variable>
      <variable name="corks" type="input" variety="cork" default-name="{{variant}} ({{container}})" abilities="close(cork_bottle)">
        <handler indicator="population"/>
      </variable>
      <variable name="wine_man" type="doer" abilities="drive(corker), drive(bottler), move"/>
      <variable name="hand_drawn" type="tool" variety="equipment" abilities="fill(bottle)"/>
      <variable name="corker" type="tool" variety="equipment" abilities="close(bottle)"/>
      <variable name="wine_bottles" type="output" variety="wine" derivative-of=":wine_to_pack" default-name="{{variant}} [{{birth_month_abbr}}. {{birth_year}}] ({{container}})">
        <handler indicator="population"/>
      </variable>
    </variables>
  </procedure>
</procedures>
