<?xml version="1.0"?>
<procedures xmlns="http://www.ekylibre.org/XML/2013/procedures">
  <procedure name="mammal_herd_milking" natures="milk_production" version="0">
    <variables>
      <variable name="mammal_herd_to_milk" variety="animal_group" derivative-of="mammalia" abilities="produce(milk)" roles="milk_production-target" default-actor="default_storage_of_support"/>
      <variable name="milk" variety="milk" derivative-of=":mammal_herd_to_milk" new="produced-by: mammal_herd_to_milk" roles="milk_production-output" default-name="{{variant}} [{{birth_day}}/{{birth_month}}/{{birth_year}}] ({{container}})">
        <handler indicator="population"/>
        <handler indicator="net_mass" unit="kilogram" to="population" backward="value * self..net_mass(kilogram)" forward="value / self..net_mass(kilogram)"/>
        <handler name="milk_mass_per_animal" indicator="net_mass" unit="kilogram" if="members_count(mammal_herd_to_milk) &gt; 0 &amp; milk.population?" to="population" backward="value * (self..net_mass(kilogram) / members_count(mammal_herd_to_milk))" forward="value * (members_count(mammal_herd_to_milk) / self..net_mass(kilogram))"/>
      </variable>
      <variable name="caregiver" abilities="milk(mammalia)" roles="milk_production-doer"/>
      <variable name="container" abilities="store(milk)"/>
    </variables>
    <operations>
      <operation id="1">
        <task do="[mammal_herd_to_milk] produces [milk]"/>
        <task do="[milk] is in [container]"/>
      </operation>
    </operations>
  </procedure>
</procedures>
