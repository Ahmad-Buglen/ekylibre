<?xml version="1.0"?>
<template title="Example" orientation="portrait" format="210x297" unit="mm" query-standard="sql" size="10">
  <title query="select current_user">The Book of #{title.current_user}</title>
  <infos>
    <info type="created-on">04/09/2008</info>
  </infos>
  <loop name="loop0">
    <block type="footer">
      <line x1="5" y1="0" x2="200" y2="0" border-color="#000" />
      <text x="10" y="3" width="100" height="5" align="L">imprimé le {CURRENT_TIMESTAMP:%e %B %Y à %H %M } </text>
      <text x="180" y="3" width="30" height="5" align="L">Page {PAGENO}/{PAGENB}</text>
      <text x="90" y="2" width="20" height="5" align="C">   {LOCAL:company_name}  </text>
      <text x="90" y="6" width="20" height="5" align="C" size="7"> SIREN : {LOCAL:siren} </text>
    </block>
    <block name="company">
      <text x="10" y="10" width="100" height="15" align="L" size="15"> {LOCAL:company_name} </text>
      <text x="10" y="15" width="50" height="15" align="L" size="10">  SIREN : {LOCAL:siren} </text>
      <text x="65" y="25" width="70" height="15" align="C" size="15"> Grand Livre </text>
      <text x="65" y="35" width="70" height="15" align="C" size="15" weight="bold"> Période : du {LOCAL:from} au {LOCAL:to} </text>
      <text x="65" y="50" width="200" height="10" align="C" >    </text>
    </block>
    <loop name="ledger" query="SELECT id , number , name FROM accounts ORDER BY number">
      <block name="test">
	<text x="10" y="0" width="70" height="7.5" align="L" border-width="0.2">Compte n° #{ledger.number}</text>
	<text x="80" y="0" width="120" height="7.5" align="L" border-width="0.2">Nom #{ledger.name}</text>
      </block>
      <loop name="entries" query="SELECT name , debit , credit, created ,1 FROM(SELECT entries.name as name , entries.debit as debit , entries.credit as credit , journal_records.created_on as created FROM entries INNER JOIN accounts ON entries.account_id = accounts.id INNER JOIN journal_records ON entries.record_id = journal_records.id WHERE journal_records.created_on BETWEEN '{LOCAL:from}'::date AND '{LOCAL:to}'::date AND entries.account_id = #{ledger.id} GROUP BY  journal_records.created_on, entries.name , entries.debit , entries.credit ORDER BY journal_records.created_on)as entries ">
	<block name="numeric">
	  <text x="10" y="0" width="35" height="5" align="L" border-width="0.2">#{entries.created}</text>
	  <text x="45" y="0" width="100" height="5" align="L" border-width="0.2">#{entries.name}</text>
	  <text x="145" y="0" width="27.5" height="5" align="R" border-width="0.2">#{entries.debit}</text>
	  <text x="172.5" y="0" width="27.5" height="5" align="R" border-width="0.2">#{entries.credit}</text>
	</block>
      </loop>
    </loop>
  </loop>
</template>
