=render :partial=>"shared/entities_search"
=toolbar do |t|
  -t.update @entity
  -t.print :entity, :id=>@entity.id


=list_evalue(3) do |l|
  -l.evalue @entity, :last_name
  -l.evalue @entity, :first_name unless @entity.first_name.blank?
  -l.evalue @entity, :nature if @entity.nature
  -l.evalue @entity, :code
  -l.evalue @entity, :active
  -l.evalue @entity, :website unless @entity.website.blank?
  -l.evalue Entity.human_attribute_name("country"), image_tag("countries/"+@entity.country+".png")+" "+t("countries."+@entity.country) unless @entity.country.blank?
  -l.evalue @entity, :siren unless @entity.siren.blank?
  -l.evalue @entity, :activity_code unless @entity.activity_code.blank?
  -l.evalue @entity, :vat_number unless @entity.vat_number.blank?
  -l.evalue @entity, :excise unless @entity.vat_number.blank?
  -l.evalue @entity, :born_on unless @entity.born_on.blank?
  -l.evalue @entity, :dead_on unless @entity.dead_on.blank?
  -l.evalue @entity, :website  unless @entity.website.blank?
  -l.evalue @entity, :comment unless @entity.comment.blank?
  -l.evalue @entity, :prospect
  -l.evalue @entity, :client
  -if @entity.client
    -l.evalue @entity, :category, :label=>:name, :url=>{:action=>:entity_category}
    -l.evalue @entity, :first_met_on unless @entity.first_met_on.blank?
    -l.evalue @entity, :proposer, :label=>:full_name unless @entity.proposer_id.blank?
    -l.evalue @entity, :vat_submissive
    -l.evalue @entity, :reflation_submissive 
    -l.evalue @entity, :reduction_rate unless @entity.reduction_rate.blank?
    -l.evalue @entity, :authorized_payments_count unless @entity.authorized_payments_count.blank?
    -l.evalue @entity, :deliveries_conditions unless @entity.deliveries_conditions.blank?
    -l.evalue @entity, :client_account, :url=>{:controller=>:accountancy, :action=>:account}
  -l.evalue @entity, :supplier
  -if @entity.supplier
    -l.evalue @entity, :supplier_account, :url=>{:controller=>:accountancy, :action=>:account}
  -l.evalue @entity, :attorney
  -if @entity.attorney
    -l.evalue @entity, :attorney_account, :url=>{:controller=>:accountancy, :action=>:account}
  -l.evalue @entity, :transporter
  -for datum in @entity.custom_field_data.find(:all, :joins=>"JOIN custom_fields ON (custom_fields.id=custom_field_id)", :order=>"position")
    -l.evalue datum.custom_field.name, datum.value.to_s unless datum.value.to_s.blank?

 
=tabbox(:entity) do |tb|
  -tb.tab(tc(:x_subscriptions, :count=>@entity.subscriptions.count)) do |c|
    -c << toolbar do
      -link(:subscription_create, :controller=>:management, :entity_id=>@entity.id)
    -c << kame(:entity_subscriptions)
  -tb.tab(tc(:contacts, :count=>@entity.contacts.count)) do |c|
    -c << toolbar do
      -link(:contact_create, :entity_id=>@entity.id)
    -c << kame(:entity_contacts)
  -tb.tab(tc(:x_sales_orders, :count=>@entity.sales_orders.count)) do |c|
    -c << toolbar do |t|
      -t.link(:sales_order_create, :controller=>:management, :client_id=>@entity.id)
    -c << kame(:entity_sales_orders)
  -tb.tab(tc(:x_purchase_orders, :count=>@entity.purchase_orders.count)) do |c|
    -c << toolbar do |t|
      -t.link(:purchase_order_create, :controller=>:management, :supplier_id=>@entity.id)
    -c << kame(:entity_purchase_orders)
  -tb.tab(tc(:x_sales_invoices, :count=>@entity.sales_invoices.count)) do |c|
    -c << kame(:entity_sales_invoices)
  -tb.tab(tc(:x_incoming_payments, :count=>@entity.incoming_payments.count)) do |c|
    -c << toolbar do
      -link :incoming_payment_create,{:controller=>:management, :payer_id=>@entity.id}
    -c << kame(:entity_incoming_payments)
  -tb.tab(tc(:outgoing_payments, :count=>@entity.outgoing_payments.size)) do |c|
    -c << toolbar do
      -link :outgoing_payment_create,{:controller=>:management, :payee_id=>@entity.id}
    -c << kame(:entity_outgoing_payments)
  -tb.tab(tc(:x_events, :count=>@entity.events.count)) do |c|
    -c << toolbar do
      -link :event_create, :entity_id=>@entity.id
    -c << kame(:entity_events)
  -el_count = @current_company.entity_links.find(:all, :conditions=>["stopped_on IS NULL AND ? IN (entity_1_id, entity_2_id)", @entity.id]).size
  -tb.tab(tc(:entity_links, :count=>el_count)) do |c|
    -c << toolbar do
      -link :entity_link_create, {:entity_id=>@entity.id}
    -c << kame(:entity_links)
  -tb.tab(tc(:observations, :count=>@entity.observations.count)) do |c|
    -c << toolbar do
      -link :observation_create, {:entity_id=>@entity.id}
    -c << kame(:entity_observations)
  -tb.tab(tc(:mandates, :count=>@entity.mandates.count)) do |c|
    -c << toolbar do
      -link :mandate_create, {:entity_id=>@entity.id}
    -c << kame(:entity_mandates)
  -tb.tab(tc(:cashes, :count=>@entity.cashes.count)) do |c|
    -c << toolbar do
      -link :cash_create, {:controller =>:accountancy, :entity_id=>@entity.id}
    -c << kame(:entity_cashes)
