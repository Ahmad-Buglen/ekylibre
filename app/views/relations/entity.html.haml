=render :partial=>"shared/entities_search"
=toolbar do |t|
  -t.update @entity
  -t.print :entity, :id=>@entity.id


=attributes_list(@entity) do |l|
  -l.attribute :last_name
  -l.attribute :first_name unless @entity.first_name.blank?
  -l.attribute :nature if @entity.nature
  -l.attribute :code
  -l.attribute :active
  -l.attribute :website unless @entity.website.blank?
  -l.evalue Entity.human_attribute_name("country"), image_tag("countries/"+@entity.country+".png")+" "+t("countries."+@entity.country) unless @entity.country.blank?
  -l.attribute :siren unless @entity.siren.blank?
  -l.attribute :activity_code unless @entity.activity_code.blank?
  -l.attribute :vat_number unless @entity.vat_number.blank?
  -l.attribute :excise unless @entity.vat_number.blank?
  -l.attribute :born_on unless @entity.born_on.blank?
  -l.attribute :dead_on unless @entity.dead_on.blank?
  -l.attribute :website  unless @entity.website.blank?
  -l.attribute :comment unless @entity.comment.blank?
  -l.attribute :prospect
  -l.attribute :client
  -if @entity.client
    -l.attribute :category, :label=>:name, :url=>{:action=>:entity_category}
    -l.attribute :first_met_on unless @entity.first_met_on.blank?
    -l.attribute :proposer, :label=>:full_name unless @entity.proposer_id.blank?
    -l.attribute :vat_submissive
    -l.attribute :reflation_submissive 
    -l.attribute :reduction_rate unless @entity.reduction_rate.blank?
    -l.attribute :authorized_payments_count unless @entity.authorized_payments_count.blank?
    -l.attribute :deliveries_conditions unless @entity.deliveries_conditions.blank?
    -l.attribute :client_account, :url=>{:controller=>:accountancy, :action=>:account}
  -l.attribute :supplier
  -if @entity.supplier
    -l.attribute :supplier_account, :url=>{:controller=>:accountancy, :action=>:account}
  -l.attribute :attorney
  -if @entity.attorney
    -l.attribute :attorney_account, :url=>{:controller=>:accountancy, :action=>:account}
  -l.attribute :transporter
  -for datum in @entity.custom_field_data.find(:all, :joins=>"JOIN custom_fields ON (custom_fields.id=custom_field_id)", :order=>"position")
    -l.evalue datum.custom_field.name, datum.value.to_s unless datum.value.to_s.blank?

 
=tabbox(:entity) do |tb|
  -tb.tab(tl(:x_subscriptions, :count=>@entity.subscriptions.count)) do
    =toolbar do |t|
      -t.link(:subscription_create, :controller=>:management, :entity_id=>@entity.id)
    =kame(:entity_subscriptions)
  -tb.tab(tl(:x_contacts, :count=>@entity.contacts.count)) do
    =toolbar do |t|
      -t.link(:contact_create, :entity_id=>@entity.id)
    =kame(:entity_contacts)
  -tb.tab(tl(:x_sales_orders, :count=>@entity.sales_orders.count)) do
    =toolbar do |t|
      -t.link(:sales_order_create, :controller=>:management, :client_id=>@entity.id)
    =kame(:entity_sales_orders)
  -tb.tab(tl(:x_incoming_payments, :count=>@entity.incoming_payments.count)) do
    =toolbar do |t|
      -t.link :incoming_payment_create,{:controller=>:management, :payer_id=>@entity.id}
    =kame(:entity_incoming_payments)
  -tb.tab(tl(:x_purchase_orders, :count=>@entity.purchase_orders.count)) do
    =toolbar do |t|
      -t.link(:purchase_order_create, :controller=>:management, :supplier_id=>@entity.id)
    =kame(:entity_purchase_orders)
  -tb.tab(tl(:x_outgoing_payments, :count=>@entity.outgoing_payments.size)) do
    =toolbar do |t|
      -t.link :outgoing_payment_create,{:controller=>:management, :payee_id=>@entity.id}
    =kame(:entity_outgoing_payments)
  -tb.tab(tl(:x_events, :count=>@entity.events.count)) do
    =toolbar do |t|
      -t.link :event_create, :entity_id=>@entity.id
    =kame(:entity_events)
  -el_count = @current_company.entity_links.find(:all, :conditions=>["stopped_on IS NULL AND ? IN (entity_1_id, entity_2_id)", @entity.id]).size
  -tb.tab(tl(:x_entity_links, :count=>el_count)) do
    =toolbar do |t|
      -t.link :entity_link_create, {:entity_id=>@entity.id}
    =kame(:entity_links)
  -tb.tab(tl(:x_observations, :count=>@entity.observations.count)) do
    =toolbar do |t|
      -t.link :observation_create, {:entity_id=>@entity.id}
    =kame(:entity_observations)
  -tb.tab(tl(:x_mandates, :count=>@entity.mandates.count)) do
    =toolbar do |t|
      -t.link :mandate_create, {:entity_id=>@entity.id}
    =kame(:entity_mandates)
  -tb.tab(tl(:x_cashes, :count=>@entity.cashes.count)) do
    =toolbar do |t|
      -t.link :cash_create, {:controller =>:accountancy, :entity_id=>@entity.id}
    =kame(:entity_cashes)
