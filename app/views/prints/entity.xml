<?xml version="1.0"?>
<template title="Example" lang="fr" version="2.0">
  <infos>
    <info name="authors">Thibaud Mérigon, Brice Texier</info>
  </infos>
  <parameters>
    <parameter name="entity" nature="entity">Fiche relation</parameter>
  </parameters>
  <document unit="mm" size="10" title="entity.label">
    <page orientation="portrait" format="A4" margin="10mm">

      <part height="20mm">
	<set>
	  <text value="{{entity/full_name}}"  left="50%" align="center" bold="true" size="14"/>
	</set>
      </part>
      
      <!-- Contacts -->
      <part if="entity.contacts.size > 0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.contacts.size.to_s}} contact(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <table if="entity.contacts.size&gt;0" collection="entity.contacts">
	<column label="Adresse" property="address" width="100mm"/>
      </table>

      <!-- Ventes -->
      <part if="entity.sale_orders.size&gt;0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.sale_orders.size.to_s}} vente(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <iteration variable="sale_order" collection="entity.sale_orders">
	<table collection="sale_order.lines">
	  <column label="Vente {{sale_order.number}} du {{sale_order.created_on}} d'un montant de {{sale_order.amount_with_taxes}}" property="product.name" width="100mm"/>
	  <column label="Qté." property="quantity" width="20mm" numeric="money"/>
	  <column label="Prix" property="price/amount" width="20mm" numeric="money"/>
	  <column label="HT" property="amount" width="20mm" numeric="money"/>
	  <column label="TTC" property="amount_with_taxes" width="20mm" numeric="money"/>
	</table>
      </iteration>
      
      <!-- Factures-->
      <part if="entity.invoices.size&gt;0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.invoices.size.to_s}} facture(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <iteration variable="invoice" collection="entity.invoices">
	<table collection="invoice.lines">
	  <column label="Facture {{invoice.number}} du {{invoice.created_on}} d'un montant de {{invoice.amount_with_taxes}}" property="product.name" width="100mm"/>
	  <column label="Montant HT" property="amount" width="30mm" numeric="money"/>
	  <column label="Montant TTC" property="amount_with_taxes" width="30mm" numeric="money"/>
	</table>
      </iteration>
      
      <!-- Evénements -->
      <part if="entity.events.size > 0" height="10mm">
	<set top="5mm">
	  <text value="{{entity.events.size.to_s}} événement(s)" bold="true" left="50%" align="center"/>
	</set>
      </part>
      <table if="entity.events.size&gt;0" collection="entity.events">
	<column label="Type" property="nature.name" width="25mm"/>
	<column label="Motif" property="reason" width="70mm"/>
	<column label="Employé" property="employee.full_name" width="45mm"/>
	<column label="Durée" property="duration" width="15mm" numeric="money"/>
	<column label="Lieu" property="location" width="30mm"/>
	<column label="À débuté le" property="started_at.to_date" width="20mm"/>
      </table>


      
    </page>
  </document>
</template>
