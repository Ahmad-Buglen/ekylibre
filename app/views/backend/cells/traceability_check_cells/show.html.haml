:ruby
  c = CapStatement.of_campaign(@campaign).first
  islets = c.cap_islets
  b = CapIslet.bounding_box
  buildings = RegisteredBuildingZone.in_bounding_box(b)
  islet_intersecting = 0
  buildings.each do |building|
    i = islets.shape_intersecting(building.shape).count
    islet_intersecting += i if i > 0
  end

  rivers = RegisteredWaterRiver.in_bounding_box(b)
  islet_water_intersecting = 0
  rivers.each do |river|
    j = islets.shape_intersecting(river.shape).count
    islet_water_intersecting += j if j > 0
  end

  i_of_campaing = Intervention.of_campaign(@campaign).count
  started_at = Date.parse("2016-10-01T00:00")
  stopped_at = Date.parse("2017-07-31T00:00")
  i_of_cultural_period = Intervention.between(started_at, stopped_at).count
  diff = i_of_campaing - i_of_cultural_period

  ints = Intervention.of_campaign(@campaign).of_nature(:fertilizing)
  unique_targets = InterventionTarget.where(intervention_id: ints.pluck(:id))
  support_count = unique_targets.pluck(:product_id).uniq.count
  avg = (ints.count / support_count) if unique_targets.any?

= infos do
  .info.important
    %span.title= "1 | Cohérence entre l'assolement réalisé et l'assolement PAC | "
    %span.value= link_to("PAC : " + c.net_surface_area.round(2).l, backend_cap_statement_path(c))
    %span.value= link_to("Assolement : " + @campaign.net_surface_area.convert(:hectare).round(2).l, backend_campaign_path(@campaign))
  .info.important
    %span.title= "4 | SPE | "
    %span.value= link_to("Nombre d'ilôts à proximité d'un bâtiment : " + islet_intersecting.to_s, backend_cap_statement_path(c))
  .info.important
    %span.title= "6 | Vérification | "
    %span.value= link_to("Nombre d'interventions hors campagne culturale : " + diff.to_s, backend_interventions_path)
  .info.important
    %span.title= "9 | fractionnement N | "
    %span.value= link_to("Nombre moyen d'interventions de fertilisation par parcelle : " + avg.to_s, backend_interventions_path)
  .info.important
    %span.title= "13 | ZNT | "
    %span.value= link_to("Nombre d'ilôts impactés par une zone de non traitement : " + islet_water_intersecting.to_s, backend_interventions_path)
