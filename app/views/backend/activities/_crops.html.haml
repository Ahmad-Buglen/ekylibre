- calibrations_by_nature = @crops.resultset.map(&:calibrations_by_nature).first

= grid(@crops) do |g|
  - g.column name: :plant.tl, html: { id: 'plantColumn' } do |crop|
    - link_to(crop.name, backend_product_path(crop))


  - g.column name: :last_inspection.tl, html: { id: 'lastInspectionColumn' } do |crop|
    - if crop.last_inspection.nil?
      - crop.last_inspection_number
    - else
      - link_to(crop.last_inspection_number, backend_inspection_path(crop.last_inspection))


  - g.column name: :forecast_harvest_week.tl, html: { id: 'forecastHarvestWeekColumn' } do |crop|
    - crop.last_inspection_forecast_harvest_week


  - g.column name: :harvested_area.tl, html: { id: 'harvestedAreaColumn' } do |crop|
    - crop.human_harvested_area


  - g.column name: :available_area.tl, html: { id: 'availableAreaColumn' } do |crop|
    - crop.human_available_area


  - g.column name: 'Volume net disponible', html: { id: 'netVolumeAvailableColumn' } do |crop|
    - content_tag(:div, nil) do
      %p= crop.human_net_volume_available(:items_count, crop.items_count_per_area_unit)
      %p= crop.human_net_volume_available(:net_mass, crop.net_mass_per_area_unit)


  - calibrations_by_nature.each_with_index do |(nature,calibrations), index|
    - g.column name: nature, html: { id: "inspectionCalibration#{index}" } do |crop|
      - content_tag(:div, nil) do
        %p= crop.calibration_quantity(calibrations, :items_count)
        %p= crop.calibration_quantity(calibrations, :net_mass)


  - g.column name: :disease_percentage.tl, html: { id: 'diseasePercentageColumn' } do |crop|
    - content_tag(:div, nil) do
      %p= crop.last_inspection_disease_percentage(:items_count, crop.items_count_quantity_unit)
      %p= crop.last_inspection_disease_percentage(:net_mass, crop.net_mass_quantity_unit)


  - g.column name: :deformity_percentage.tl, html: { id: 'deformityPercentageColumn' } do |crop|
    - content_tag(:div, nil) do
      %p= crop.last_inspection_deformity_percentage(:items_count, crop.items_count_quantity_unit)
      %p= crop.last_inspection_deformity_percentage(:net_mass, crop.net_mass_quantity_unit)


  - g.column name: :comment.tl, html: { id: 'commentColumn' } do |crop|
    - crop.last_inspection_comment