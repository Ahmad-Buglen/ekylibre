-@financial_year = FinancialYear.at(@journal_entry.printed_on)
-if @financial_year
  -if @journal.currency != @financial_year.currency
    =field_set :exchange_rate do
      =field tl(:exchange_rate_from_x_to_y, :x => @journal.currency.to_currency.name, :y => @financial_year.currency.to_currency.name), text_field(:journal_entry, :original_currency_rate)

=toolbar do |t|
  -t.link :new, {:controller => :journal_entry_items, :printed_on => @journal_entry.printed_on, :journal_id => @journal.id}, :remote => true, "data-update" => "#items", "data-update-at" => :bottom, "data-type" => :html, :method => :get
.active-list
  %table.list{:style => "margin-bottom: 8px;"}
    %thead
      %tr
        %th=JournalEntryLine.human_attribute_name("name")
        %th=JournalEntryLine.human_attribute_name("account")
        %th{"colspan" => 2}=JournalEntryLine.human_attribute_name("debit")
        %th{"colspan" => 2}=JournalEntryLine.human_attribute_name("credit")
        %th.act
    %tfoot
      %tr#total.total{"data-valid-if-equality-between" => "#entry-original-debit, #entry-original-credit"}
        %th{"colspan" => 2}=tl(:total_in_currency, :currency => @journal.currency.to_currency.name)
        %td#entry-original-debit.decimal{"colspan" => 2, "data-use" => "input.original-debit"}=@journal_entry.original_debit
        %td#entry-original-credit.decimal{"colspan" => 2, "data-use" => "input.original-credit"}=@journal_entry.original_credit

      -if @financial_year and@journal.currency != @financial_year.currency
        %tr.subtotal{"data-valid-if-equality-between" => "#entry-debit, #entry-credit"}
          %th{"colspan" => 2}=tl(:total_in_currency, :currency => @financial_year.currency.to_currency.name)
          %td#entry-debit.decimal{"colspan" => 2, "data-use" => "td.debit"}=@journal_entry.debit
          %td#entry-credit.decimal{"colspan" => 2, "data-use" => "td.credit"}=@journal_entry.credit

    %tbody#items.items
      -items = @journal_entry_items || @journal_entry.items
      =render :partial => "journal_entry_items/row_form", :collection => items
      =render :partial => "journal_entry_items/row_form", :object => @journal_entry.items.new if items.empty?
