-if !session[:errors].nil?
  -if !session[:errors].empty?
    .errorExplanation
      %h2=session[:errors].size.to_s+" erreur(s) ont empéché l'enregistrement"
      %p Il y a eu des problèmes avec les champs suivantes :
      %ul
        -for error in session[:errors]
          %li= error.to_s


- form_tag() do
  %table.dyta 
    %tr
      %th= tc('product')
      %th= tc('price_amount')
      %th= tc('price_amount_with_taxes')
      %th= tc('unit')
      %th= tc('total_quantity')
      %th= tc('already_credited_quantity')
      %th= tc('quantity_to_credit')
    - for @line in @invoice_cancel_lines
      %tr{:class=>cycle('odd','even')}
        %td= @line.product.name
        %td= @line.price.amount
        %td= @line.price.amount_with_taxes
        %td= @line.product.unit.name
        %td= @line.origin.quantity
        -if @line.quantity == 0
          %td= @line.quantity
        -else
          %td= @line.quantity.to_f*-1
        %td= text_field_tag "invoice_cancel_line[#{@line.origin_id}][quantity]", (@line.origin.quantity - (@line.quantity*-1) ), :id=>"invoice_cancel_line_#{@line.origin_id}_quantity"

  .actions
    =link_to tg(:previous), :action=>:invoices
    =submit_tag(tc('validate'), :action=>:invoices_cancel)

  
