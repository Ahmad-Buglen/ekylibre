<?xml version="1.0"?>
<template title="Example" orientation="portrait" format="210x297" unit="mm" query-standard="sql" size="10">
  <title query="select current_user">The Book of #{title.current_user}</title>
  <infos>
    <info type="created-on">04/09/2008</info>
  </infos>
  <loop name="loop0">
    <block type="header" mode="even">
      <text x="2" y="2" width="206" height="15" align="L">En-tête paire {LOCAL:current_company} {KEY}</text>
    </block>
      <block type="header" mode="odd">
	<text x="2" y="2" width="206" height="15" align="R" radius="2">En-tête impaire {KEY}</text>
      </block>
      <block type="footer">
	<line x1="5" y1="0" x2="200" y2="0" border-color="#F00" />
	<text x="5" y="2" width="200" height="5" align="C" decoration="underline">Page {PAGENO}/{PAGENB}</text>
      </block>
      <block name="titre">
	<text x="65" y="3" width="300" height="15" align="L" decoration="underline" size="15"> Balance de la periode  {LOCAL:from::date} a {LOCAL:to::date} </text>
      </block>
      <block name="menu">
	<text x="5" y="0" width="150" height="10" align="L" border-width="0.2" >Compte</text>
	<text x="155" y="0" width="55" height="10" align="C" border-width="0.2" >Solde</text>
	<text x="5" y="10" width="20" height="10" align="L" border-width="0.2" >Numero</text>
	<text x="25" y="10" width="130" height="10" align="L" border-width="0.2" border-align="C" >Intitule</text>
	<text x="155" y="10" width="27.5" height="10" align="R" border-width="0.2" >Debit</text>
	<text x="182.5" y="10" width="27.5" height="10" align="R" border-width="0.2"  >Credit</text>
      </block>
      <loop name="balance" query="SELECT number , name , local_credit , local_debit, solde FROM accounts LEFT JOIN (SELECT account_id, coalesce(sum(entries.credit),0) as local_credit, coalesce(sum(entries.debit),0) as local_debit, coalesce(sum(entries.credit),0) - coalesce(sum(entries.debit),0) as solde FROM entries INNER JOIN journal_records ON entries.record_id = journal_records.id  WHERE journal_records.created_on BETWEEN '{LOCAL:from}'::date AND '{LOCAL:to}'::date GROUP BY account_id) as balance ON accounts.id = account_id ORDER BY number">
	<block name="test">
	  <text x="5" y="0" width="20" height="5" align="L" border-width="0.2">#{balance.number}</text>
	  <text x="25" y="0" width="130" height="5" align="L" border-width="0.2">#{balance.name}</text>
	  <text x="155" y="0" width="27.5" height="5" align="R" border-width="0.2">#{balance.local_debit}</text>
	 <!-- <text x="155" y="0" width="27.5" height="5" align="R" border-width="0.2">   </text> -->
	  <text x="182.5" y="0" width="27.5" height="5" align="R" border-width="0.2">#{balance.local_credit}</text>
	 <!-- <text x="182.5" y="0" width="27.5" height="5" align="R" border-width="0.2">  </text>-->
	</block>
      </loop>
    <page-break/>
    <block name="conclusion">
      <text x="15" y="2" width="180" height="50" align="C" color="#F40" weight="bold" decoration="underline" style="italic" size="18">The End</text>
    </block>
  </loop>
</template>

